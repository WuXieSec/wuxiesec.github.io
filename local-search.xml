<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>红日靶场（一）（上）</title>
    <link href="/2022/08/26/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%911/"/>
    <url>/2022/08/26/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%911/</url>
    
    <content type="html"><![CDATA[<h1 id="红日内网靶场——红队评估-一-上"><a href="#红日内网靶场——红队评估-一-上" class="headerlink" title="红日内网靶场——红队评估(一)(上)"></a>红日内网靶场——红队评估(一)(上)</h1><h4 id="一、环境搭建"><a href="#一、环境搭建" class="headerlink" title="一、环境搭建"></a>一、环境搭建</h4><h5 id="1-1、环境部署"><a href="#1-1、环境部署" class="headerlink" title="1.1、环境部署"></a>1.1、环境部署</h5><ul><li>WIN7 （web服务器） 双网卡（内外网 IP）<ul><li>网卡 1 IP:192.168.52.143 （内网服务器 存在yxcms）</li><li>网卡 2 IP:192.168.17.130（外网DHCP自动获取）</li></ul></li><li>WIN 2008（域控） 单内网网卡<ul><li>网卡IP：192.168.52.138</li></ul></li><li>WIN 2003 （域成员） 单内网卡<ul><li>网卡IP ：192.168.52.141</li></ul></li><li>Kali （攻击机） 外网网卡<ul><li>网卡IP：192.168.17.131</li></ul></li></ul><h5 id="1-2、拓扑图"><a href="#1-2、拓扑图" class="headerlink" title="1.2、拓扑图"></a>1.2、拓扑图</h5><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/1.png"></p><h4 id="二、信息收集"><a href="#二、信息收集" class="headerlink" title="二、信息收集"></a>二、信息收集</h4><h5 id="2-1、页面信息收集"><a href="#2-1、页面信息收集" class="headerlink" title="2.1、页面信息收集"></a>2.1、页面信息收集</h5><ul><li>192.168.17.130 打开是一个phpstudy的探针<ul><li>有一个数据库测试功能，尝试弱口令 root&#x2F;root，测试正常，说明数据库存在弱口令</li><li>发现了绝对路径和一些组件的版本信息，绝对路径可以sql注入写shell，版本信息可以找一些历史漏洞</li></ul></li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/2.png"></p><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/3.png"></p><h5 id="2-2、端口加敏感目录扫描"><a href="#2-2、端口加敏感目录扫描" class="headerlink" title="2.2、端口加敏感目录扫描"></a>2.2、端口加敏感目录扫描</h5><ul><li>使用nmap对192.168.17.130进行端口扫描 找找是否存在高危端口<ul><li>存在3306端口，是mysql的端口，刚才已经知道有弱口令了，一会儿可以直接利用。</li></ul></li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/4.png"></p><ul><li>使用dirb扫描目录 探测是否存在敏感目录<ul><li>存在phpmyadmin，知道绝对路径，可以尝试写shell</li></ul></li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/5.png"></p><ul><li>登陆phpmyadmin看看是否有可以利用的数据<ul><li>root&#x2F;root 弱口令登陆成功</li></ul></li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/6.png"></p><ul><li>发现存在yxcms的数据库，尝试访问yxcms的路径。</li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/8.png"></p><h5 id="2-3、yxcms的信息收集"><a href="#2-3、yxcms的信息收集" class="headerlink" title="2.3、yxcms的信息收集"></a>2.3、yxcms的信息收集</h5><ul><li>观察页面，发现公告上写着后台路径和 默认口令<ul><li>后台路径：&#x2F;index.php?r&#x3D;admin 默认口令：admin&#x2F;123456</li></ul></li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/9.png"></p><ul><li>访问后台尝试默认密码登陆</li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/10.png"></p><ul><li>登陆成功</li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/11.png"></p><ul><li>通过观察后台页面，发现 有一个前台模版新建模版的功能点，可以直接写 php文件。</li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/12.png"></p><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/13.png"></p><h4 id="三、漏洞利用"><a href="#三、漏洞利用" class="headerlink" title="三、漏洞利用"></a>三、漏洞利用</h4><h5 id="3-1、利用phpmyadmin写shell"><a href="#3-1、利用phpmyadmin写shell" class="headerlink" title="3.1、利用phpmyadmin写shell"></a>3.1、利用phpmyadmin写shell</h5><ul><li>直接通过 SQL 查询语句 outfile 写入一句话木马，先看是否存在写入的权限<ul><li>show global variables like ‘%secure%’;<ul><li>显示为NULL 只可读不可写</li></ul></li></ul></li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/14.png"></p><ul><li><p>开启全局日志getshell</p><ul><li>show variables like ‘%general%’;查询全局日志变量配置</li></ul></li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/15.png"></p><ul><li>开启general_log将所有查询语句都记录到指定可以访问的文件中</li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/16.png"></p><ul><li>日志记录的目录，是绝对路径，在php探针上已经拿到。</li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/17.png"></p><ul><li>检查是否更改成功</li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/17.png"></p><ul><li>尝试写入一句话木马. 就算报错日志也会记录下来。</li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/18.png"></p><ul><li>尝试用哥斯拉连接  成功</li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/19.png"></p><h5 id="3-2、yxcms上传webshell"><a href="#3-2、yxcms上传webshell" class="headerlink" title="3.2、yxcms上传webshell"></a>3.2、yxcms上传webshell</h5><ul><li>利用前台模版新建一个php页面，写上一句话木马，抓包看看是否有回显路径<ul><li>并没有返回URL的路径，只能试试别的办法</li></ul></li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/20.png"></p><ul><li><p>没有路径 可以看看robots.txt 或者去做目录扫描，看看是否有新的发现</p><ul><li><p>访问robots.txt 看是否存在可利用的目录</p><ul><li>存在&#x2F;data &#x2F;protected目录 访问了一下 发现有个目录浏览，找到刚才传的she_ll.php</li></ul></li></ul></li></ul><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/22.png"></p><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/23.png"></p><pre><code class="hljs">- 路径http://192.168.17.130/yxcms//protected/apps/default/view/default/she_ll.php</code></pre><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/25.png"></p><pre><code class="hljs">- 尝试连接</code></pre><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/26.png"></p><p><img src="/../images/%E7%BA%A2%E6%97%A5%E5%86%85%E7%BD%91%201/27.png"></p>]]></content>
    
    
    <categories>
      
      <category>内网</category>
      
    </categories>
    
    
    <tags>
      
      <tag>内网学习</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
